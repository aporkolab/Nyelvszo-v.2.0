<!-- Search Section -->
<div class="s004">
  <div class="form-group">
    <img src="/assets/img/logo.png" alt="NyelvSzo logo" id="logo" />
    <legend>{{ 'WHAT ARE YOU LOOKING FOR?' | translate }}</legend>
    <div class="tableData inner-form">
      <div class="col-12 select_container input-field">
        <select
          [(ngModel)]="filterKey"
          (ngModelChange)="onFilterKeyChange()"
          id="tableSearch"
          class="form-control"
        >
          <option value="">{{ 'table.searchAll' | translate }}</option>
          <option *ngFor="let col of columns" [value]="col.key">
            {{ col.title | translate }}
          </option>
        </select>
      </div>
      <div class="mb-3 input_container">
        <input
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange()"
          type="text"
          class="form-control"
          id="choices-text-preset-values"
          placeholder="{{ 'placeholder' | translate }}"
        />
      </div>
    </div>
    <!-- Search info -->
    <div class="search-info text-muted text-center mt-2" *ngIf="pagination && hasSearched">
      <small>
        {{ 'Found' | translate }}: {{ pagination.totalItems }} {{ 'entries' | translate }}
        <span *ngIf="pagination.totalPages > 1">
          ({{ 'page' | translate }} {{ pagination.currentPage }}/{{ pagination.totalPages }})
        </span>
      </small>
    </div>
    <div class="text-muted text-center mt-2" *ngIf="!hasSearched">
      <small>{{ 'Enter at least 2 characters to search' | translate }}</small>
    </div>
  </div>
</div>

<!-- Loading indicator -->
<div *ngIf="entryService.searching$ | async" class="text-center my-4">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">{{ 'Loading...' | translate }}</span>
  </div>
</div>

<!-- Results Section -->
<div class="col-12 scroll tableData" *ngIf="!(entryService.searching$ | async)">

  <!-- Add new button (admin only) -->
  <div>
    <button
      *ngIf="auth.user$.value?.role === 3"
      [routerLink]="['edit', '0']"
      class="btn btn-success col-12"
    >
      {{ 'Add a new' | translate }} {{ entity }}
      <i-feather name="user-plus"></i-feather>
    </button>
  </div>

  <!-- No results message -->
  <div *ngIf="hasSearched && results.length === 0" class="text-center my-4">
    <p class="text-muted">{{ 'No entries found' | translate }}</p>
  </div>

  <!-- Results table -->
  <div class="row table-responsive" *ngIf="results.length > 0">
    <table class="table table-striped table-hover table-dark">
      <thead>
        <tr>
          <th *ngFor="let col of columns" scope="col" class="table-light">
            {{ col.title | translate }}
            <i-feather
              (click)="onColumnSelect(col.key)"
              name="Shuffle"
              style="cursor: pointer;"
            ></i-feather>
          </th>
          <th class="table-light" *ngIf="auth.user$.value?.role === 3"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of results | sorter: columnKey : sortDir">
          <td *ngFor="let col of columns">{{ row[col.key] }}</td>
          <td *ngIf="auth.user$.value?.role === 3">
            <div class="btn-group">
              <button (click)="onSelectOne(row)" class="btn btn-warning">
                <i-feather name="Settings"></i-feather>
                {{ 'Edit' | translate }}
              </button>
              <button (click)="onDeleteOne(row)" class="btn btn-danger">
                <i-feather name="file-minus"></i-feather>
                {{ 'Delete' | translate }}
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav aria-label="paginator" class="pagination-nav" *ngIf="pagination && pagination.totalPages > 1">
    <ul class="pagination justify-content-center flex-wrap gap-1">
      <!-- Previous button -->
      <li class="page-item" [class.disabled]="!pagination.hasPrevPage">
        <button
          class="page-link"
          (click)="onPageChange(currentPage - 1)"
          [disabled]="!pagination.hasPrevPage"
          aria-label="Previous"
        >
          <i-feather name="chevron-left"></i-feather>
        </button>
      </li>

      <!-- Page numbers -->
      <ng-container *ngFor="let pageNum of pageList">
        <li *ngIf="pageNum === '...'" class="page-item disabled">
          <span class="page-link ellipsis">â€¦</span>
        </li>
        <li *ngIf="pageNum !== '...'" class="page-item" [class.active]="currentPage === pageNum">
          <button class="page-link" (click)="onPageChange(+pageNum)">
            {{ pageNum }}
          </button>
        </li>
      </ng-container>

      <!-- Next button -->
      <li class="page-item" [class.disabled]="!pagination.hasNextPage">
        <button
          class="page-link"
          (click)="onPageChange(currentPage + 1)"
          [disabled]="!pagination.hasNextPage"
          aria-label="Next"
        >
          <i-feather name="chevron-right"></i-feather>
        </button>
      </li>
    </ul>
  </nav>
</div>
